FROM openjdk:11

RUN mkdir /workspace
COPY start.sh /workspace/
COPY contrast_security.yaml /workspace/
RUN chmod +x /workspace/start.sh
ADD https://repo1.maven.org/maven2/com/contrastsecurity/contrast-agent/4.13.1/contrast-agent-4.13.1.jar /workspace/contrast.jar
RUN adduser flibber
RUN chown -R flibber /workspace
USER flibber
WORKDIR /workspace
RUN git clone https://github.com/BroadleafCommerce/DemoSite.git
WORKDIR DemoSite
RUN git checkout 369d26c
COPY site-pom.xml /workspace/DemoSite/site/pom.xml
RUN ./mvnw clean install

CMD /workspace/start.sh